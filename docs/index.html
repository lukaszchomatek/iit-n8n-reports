<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Introduction to IT â€“ Automated Reports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: light dark;
    }

    body {
      margin: 0;
      display: flex;
      height: 100vh;
      background: #f5f5f5;
    }

    .sidebar {
      width: 280px;
      min-width: 220px;
      max-width: 360px;
      border-right: 1px solid #ddd;
      padding: 1rem;
      box-sizing: border-box;
      background: #ffffff;
      overflow-y: auto;
    }

    .main {
      flex: 1;
      padding: 1.5rem;
      box-sizing: border-box;
      overflow-y: auto;
    }

    h1 {
      font-size: 1.4rem;
      margin-top: 0;
      margin-bottom: 0.5rem;
    }

    h2 {
      font-size: 1.1rem;
      margin-top: 1.5rem;
    }

    .repo-info {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 1rem;
    }

    .report-list {
      list-style: none;
      padding: 0;
      margin: 0.5rem 0 0 0;
    }

    .report-list li {
      margin: 0.25rem 0;
    }

    .report-link {
      display: block;
      padding: 0.25rem 0.4rem;
      border-radius: 4px;
      text-decoration: none;
      color: #0366d6;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .report-link:hover {
      background-color: #eef5ff;
    }

    .report-link.active {
      background-color: #0366d6;
      color: #ffffff;
    }

    .status {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 1rem;
    }

    .status.error {
      color: #b00020;
    }

    .markdown-body {
      max-width: 900px;
      margin: 0 auto;
      line-height: 1.6;
      font-size: 0.95rem;
      color: #222;
    }

    .markdown-body h1 {
      font-size: 1.6rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.3rem;
      margin-top: 0;
    }

    .markdown-body h2 {
      font-size: 1.3rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.2rem;
    }

    .markdown-body pre {
      background: #f0f0f0;
      padding: 0.6rem;
      overflow-x: auto;
      border-radius: 4px;
    }

    .markdown-body code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
    }

    .markdown-body a {
      color: #0366d6;
    }

    @media (max-width: 800px) {
      body {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        max-height: 40vh;
        border-right: none;
        border-bottom: 1px solid #ddd;
      }
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <h1>Intro to IT â€“ Reports</h1>
    <div class="repo-info">
      Source: <code>lukaszchomatek/iit-n8n-reports/docs</code><br />
      Branch: <code>master</code>
    </div>
    <div id="status" class="status">Loading report listâ€¦</div>
    <ul id="report-list" class="report-list"></ul>
  </aside>

  <main class="main">
    <div id="content" class="markdown-body">
      <h1>Automated course reports</h1>
      <p>
        Select a report on the left to view its contents. Reports are generated automatically
        by a workflow connecting Baserow, n8n, LLM and GitHub Pages.
      </p>
    </div>
  </main>

  <script>
    // ðŸ”§ KONFIGURACJA â€“ jeÅ›li zmienisz repo/branch, popraw tu:
    const GITHUB_OWNER = "lukaszchomatek";
    const GITHUB_REPO = "iit-n8n-reports";
    const GITHUB_BRANCH = "master";
    const DOCS_PATH = "docs";

    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("report-list");
    const contentEl = document.getElementById("content");

    // Pobierz listÄ™ plikÃ³w z katalogu docs/ przez GitHub API
    async function fetchReportsList() {
      const apiUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${DOCS_PATH}?ref=${GITHUB_BRANCH}`;
      statusEl.textContent = "Loading report listâ€¦";

      try {
        const res = await fetch(apiUrl);
        if (!res.ok) {
          throw new Error(`GitHub API error: ${res.status}`);
        }
        const data = await res.json();

        // Filtrujemy tylko pliki .md
        const reports = data
          .filter(item => item.type === "file" && item.name.toLowerCase().endsWith(".md"))
          // sortujemy malejÄ…co po nazwie (zakÅ‚adamy, Å¼e nazwa zawiera datÄ™)
          .sort((a, b) => b.name.localeCompare(a.name));

        if (reports.length === 0) {
          statusEl.textContent = "No reports found in docs/ yet.";
          return;
        }

        statusEl.textContent = `Found ${reports.length} report(s).`;
        renderReportList(reports);
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Failed to load report list.";
        statusEl.classList.add("error");
      }
    }

    function renderReportList(reports) {
      listEl.innerHTML = "";

      reports.forEach((file, index) => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = prettifyName(file.name);
        a.className = "report-link";
        a.dataset.filename = file.name;

        a.addEventListener("click", (event) => {
          event.preventDefault();
          setActiveLink(a);
          loadReport(file.name);
        });

        li.appendChild(a);
        listEl.appendChild(li);

        // opcjonalnie â€“ automatycznie zaÅ‚aduj najnowszy raport
        if (index === 0) {
          setActiveLink(a);
          loadReport(file.name);
        }
      });
    }

    function prettifyName(filename) {
      // np. report-2025-12-04-10-30-00.md â†’ "report 2025-12-04 10:30:00"
      const name = filename.replace(/\.md$/i, "");
      return name.replace(/[-_]/g, " ");
    }

    function setActiveLink(activeEl) {
      document.querySelectorAll(".report-link").forEach(link => {
        link.classList.remove("active");
      });
      activeEl.classList.add("active");
    }

    async function loadReport(filename) {
      statusEl.textContent = `Loading ${filename}â€¦`;

      // uÅ¼ywamy raw.githubusercontent.com, Å¼eby dostaÄ‡ czysty markdown
      const rawUrl = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/${DOCS_PATH}/${filename}`;

      try {
        const res = await fetch(rawUrl);
        if (!res.ok) {
          throw new Error(`Failed to fetch report: ${res.status}`);
        }
        const markdown = await res.text();

        // render Markdown â†’ HTML przy pomocy marked
        const html = marked.parse(markdown);
        contentEl.innerHTML = html;
        statusEl.textContent = `Showing: ${filename}`;
        statusEl.classList.remove("error");
      } catch (err) {
        console.error(err);
        statusEl.textContent = `Failed to load ${filename}.`;
        statusEl.classList.add("error");
      }
    }

    // start
    fetchReportsList();
  </script>
</body>
</html>
